#include "Flash.h"
#include "GPIO_Interface.h"
#include "V94XX_FLASH.h"
#include "basic_srv.h"
#include <string.h>
#include <stdbool.h>

/* =====================================================
   Script-generated image (header + code + table)
   ===================================================== */

const uint8_t module_data[] =
{
    0x4D,0x4D,0x40,0x00,0x97,0x10,0x04,0x00,0x00,0x00,0x00,0x00,
    0x01,0x20,0x70,0x47,0x70,0x47,0x80,0xB5,0xFF,0xF7,0xFA,0xFF,
    0x00,0x28,0x01,0xD1,0xFF,0x20,0x00,0xE0,0x01,0x20,0x02,0xBD,
    0x10,0xB5,0xFF,0xF7,0xF4,0xFF,0x04,0x00,0x20,0x00,0xC0,0xB2,
    0xFF,0x28,0xF8,0xD0,0x20,0x00,0xC0,0xB2,0x10,0xBD,
    0x00,0x00,0x01,0xC0,0x03,0x00,0x05,0xC0,0x03,0x00,
    0x07,0xC0,0x03,0x00,0x19,0xC0,0x03
};

#define MODULE_SIZE   sizeof(module_data)
#define FLASH_ADDR    0x000000

/* =====================================================
   MAIN
   ===================================================== */

int main(void)
{
    S_CLK_Init(1);
    vMC_DriversInit();
    S_GpioInit_ALL_Modules();
    FLASH_gInit();
    S_SPI1_INIT();

    Delay_ms(50);

    /* ---- erase sector ---- */
    Flash_erase_sector_by_address(FLASH_ADDR);

    /* ---- write module ---- */
    FlashWrite(FLASH_ADDR, module_data, MODULE_SIZE);

    Delay_ms(20);

    /* ---- TEST LOADER ---- */
    Keypad_Init();   // must trigger loader

    while (1)
    {
        Delay_ms(1000);
    }
}
